{"version":3,"sources":["manager/SiteCreateWizard.ts"],"names":["SiteCreateWizard","$root","this","firstPanel","mode","$","data","initEvents","prototype","getRadioValue","fieldsetClass","defaultVal","$input","find","length","val","getWizardState","wording","singleMotion","motionsInitiatedBy","motionsDeadlineExists","motionsDeadline","motionScreening","needsSupporters","minSupporters","hasAmendments","amendSinglePara","amendmentInitiatedBy","amendmentDeadlineExists","amendmentDeadline","amendScreening","hasComments","hasAgenda","openNow","title","organization","subdomain","contact","showPanel","$panel","console","log","step","removeClass","addClass","$activePanel","isCorrect","window","location","hash","attr","substring","e","getNextPanel","_this","$form","change","$fieldset","parents","first","$active","trigger","each","$this","datetimepicker","locale","on","prop","$group","requesturl","replace","$err","match","get","ret","html","obj","click","ev","preventDefault","history","back","submit","parseInt"],"mappings":"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","file":"SiteCreateWizard.js","sourcesContent":["interface WizardState {\n    wording: number;\n    singleMotion: number;\n    motionsInitiatedBy: number;\n    motionsDeadlineExists: number;\n    motionsDeadline: string;\n    motionScreening: number;\n    needsSupporters: number;\n    minSupporters: number;\n    hasAmendments: number;\n    amendSinglePara: number;\n    amendmentInitiatedBy: number;\n    amendmentDeadlineExists: number;\n    amendmentDeadline: string;\n    amendScreening: number;\n    hasComments: number;\n    hasAgenda: number;\n    openNow: number;\n    title: string;\n    organization: string;\n    subdomain: string;\n    contact: string;\n}\n\nclass SiteCreateWizard {\n    private firstPanel: string = \"#panelPurpose\";\n    private mode: string;\n    private data: WizardState;\n    private $activePanel: JQuery;\n\n    constructor(private $root: JQuery) {\n        this.firstPanel = \"#panelPurpose\";\n        this.mode = $(\"#SiteCreateWizard\").data(\"mode\");\n        this.initEvents();\n    }\n\n    getRadioValue(fieldsetClass: string, defaultVal: any): any {\n        let $input = this.$root.find(\"fieldset.\" + fieldsetClass).find(\"input:checked\");\n        if ($input.length > 0) {\n            return $input.val();\n        } else {\n            return defaultVal;\n        }\n    };\n\n    getWizardState(): WizardState {\n        return {\n            wording: this.getRadioValue('wording', 1),\n            singleMotion: this.getRadioValue('singleMotion', 0),\n            motionsInitiatedBy: this.getRadioValue('motionWho', 1),\n            motionsDeadlineExists: this.getRadioValue('motionDeadline', 0),\n            motionsDeadline: this.$root.find(\"fieldset.motionDeadline .date input\").val(),\n            motionScreening: this.getRadioValue('motionScreening', 1),\n            needsSupporters: this.getRadioValue('needsSupporters', 0),\n            minSupporters: this.$root.find(\"input.minSupporters\").val(),\n            hasAmendments: this.getRadioValue('hasAmendments', 1),\n            amendSinglePara: this.getRadioValue('amendSinglePara', 0),\n            amendmentInitiatedBy: this.getRadioValue('amendmentWho', 1),\n            amendmentDeadlineExists: this.getRadioValue('amendmentDeadline', 0),\n            amendmentDeadline: this.$root.find(\"fieldset.amendmentDeadline .date input\").val(),\n            amendScreening: this.getRadioValue('amendScreening', 1),\n            hasComments: this.getRadioValue('hasComments', 1),\n            hasAgenda: this.getRadioValue('hasAgenda', 0),\n            openNow: this.getRadioValue('openNow', 0),\n            title: $(\"#siteTitle\").val(),\n            organization: $(\"#siteOrganization\").val(),\n            subdomain: $(\"#siteSubdomain\").val(),\n            contact: $(\"#siteContact\").val()\n        };\n    };\n\n    showPanel($panel: JQuery) {\n        this.data = this.getWizardState();\n        console.log(this.data);\n\n        let step = $panel.data(\"tab\");\n        this.$root.find(\".wizard .steps li\").removeClass(\"active\");\n        this.$root.find(\".wizard .steps .\" + step).addClass(\"active\");\n\n        if (this.$activePanel) {\n            this.$activePanel.removeClass(\"active\").addClass(\"inactive\");\n        }\n        $panel.addClass(\"active\").removeClass(\"inactive\");\n        this.$activePanel = $panel;\n\n        try {\n            let isCorrect = (window.location.hash == \"#\" + $panel.attr(\"id\"));\n            if ((window.location.hash == \"\" || window.location.hash == \"#\") && \"#\" + $panel.attr(\"id\") == this.firstPanel) {\n                isCorrect = true;\n            }\n            if (!isCorrect) {\n                console.log(\"change\");\n                window.location.hash = \"#\" + $panel.attr(\"id\").substring(5);\n            }\n        } catch (e) {\n            console.log(e);\n        }\n    };\n\n    getNextPanel(): string {\n        this.data = this.getWizardState();\n\n        switch (this.$activePanel.attr(\"id\")) {\n            case 'panelPurpose':\n                return \"#panelSingleMotion\";\n            case 'panelSingleMotion':\n                if (this.data.singleMotion == 1) {\n                    return \"#panelHasAmendments\";\n                } else {\n                    return \"#panelMotionWho\";\n                }\n            case 'panelMotionWho':\n                if (this.data.motionsInitiatedBy == 1) { // MOTION_INITIATED_ADMINS\n                    return \"#panelHasAmendments\";\n                } else {\n                    return \"#panelMotionDeadline\";\n                }\n            case 'panelMotionDeadline':\n                return \"#panelMotionScreening\";\n            case 'panelMotionScreening':\n                return \"#panelNeedsSupporters\";\n            case 'panelNeedsSupporters':\n                return \"#panelHasAmendments\";\n            case 'panelHasAmendments':\n                if (this.data.hasAmendments == 1) {\n                    return \"#panelAmendSinglePara\";\n                } else {\n                    return \"#panelComments\";\n                }\n            case 'panelAmendSinglePara':\n                return \"#panelAmendWho\";\n            case 'panelAmendWho':\n                if (this.data.amendmentInitiatedBy == 1) { // MOTION_INITIATED_ADMINS\n                    return \"#panelComments\";\n                } else {\n                    return \"#panelAmendDeadline\";\n                }\n            case 'panelAmendDeadline':\n                return \"#panelAmendScreening\";\n            case 'panelAmendScreening':\n                return \"#panelComments\";\n            case 'panelComments':\n                if (this.data.singleMotion == 1) {\n                    return \"#panelOpenNow\";\n                } else {\n                    return \"#panelAgenda\";\n                }\n            case 'panelAgenda':\n                return \"#panelOpenNow\";\n            case 'panelOpenNow':\n                return \"#panelSiteData\";\n        }\n    }\n\n    initEvents() {\n        let $form = this.$root;\n\n        this.$activePanel = null;\n        this.data = this.getWizardState();\n\n        $form.find(\"input\").change(() => {\n            this.data = this.getWizardState();\n        });\n        $form.find(\".radio-label input\").change(function () {\n            let $fieldset = $(this).parents(\"fieldset\").first();\n            $fieldset.find(\".radio-label\").removeClass(\"active\");\n            let $active = $fieldset.find(\".radio-label input:checked\");\n            $active.parents(\".radio-label\").first().addClass(\"active\");\n        }).trigger(\"change\");\n\n        $form.find(\"fieldset.wording input\").change(function () {\n            let wording = $form.find(\"fieldset.wording input:checked\").data(\"wording-name\");\n            $form.removeClass(\"wording_motion\").removeClass(\"wording_manifesto\").addClass(\"wording_\" + wording);\n        }).trigger(\"change\");\n\n        $form.find(\".input-group.date\").each(function () {\n            let $this = $(this);\n            $this.datetimepicker({\n                locale: $this.find(\"input\").data('locale')\n            });\n        });\n        $form.find(\".date.motionsDeadline\").on(\"dp.change\", function () {\n            $(\"input.motionsDeadlineExists\").prop(\"checked\", true).change();\n        });\n        $form.find(\".date.amendmentDeadline\").on(\"dp.change\", function () {\n            $(\"input.amendDeadlineExists\").prop(\"checked\", true).change();\n        });\n        $form.find(\"input.minSupporters\").change(function () {\n            $(\"input.needsSupporters\").prop(\"checked\", true).change();\n        });\n        $form.find(\"#siteSubdomain\").on(\"keyup change\", function () {\n            let $this = $(this),\n                subdomain = $this.val(),\n                $group = $this.parents(\".subdomainRow\").first(),\n                requesturl = $this.data(\"query-url\").replace(/SUBDOMAIN/, subdomain),\n                $err = $group.find(\".subdomainError\");\n\n            if (subdomain == \"\") {\n                $err.addClass(\"hidden\");\n                $group.removeClass(\"has-error\").removeClass(\"has-success\");\n                return;\n            }\n            if (!subdomain.match(/^[A-Z0-9äöü](?:[A-Z0-9äöü_\\-]{0,61}[A-Z0-9äöü])?$/i)) {\n                $group.removeClass(\"has-success\").addClass(\"has-error\");\n                $form.find(\"button[type=submit]\").prop(\"disabled\", true);\n                return;\n            }\n            $.get(requesturl, function (ret) {\n                if (ret['available']) {\n                    $err.addClass(\"hidden\");\n                    $group.removeClass(\"has-error\");\n                    $form.find(\"button[type=submit]\").prop(\"disabled\", false);\n                    if (ret['subdomain'] == $this.val()) {\n                        $group.addClass(\"has-success\");\n                    }\n                } else {\n                    $err.removeClass(\"hidden\");\n                    $err.html($err.data(\"template\").replace(/%SUBDOMAIN%/, ret['subdomain']));\n                    $group.removeClass(\"has-success\");\n                    if (ret['subdomain'] == $this.val()) {\n                        $form.find(\"button[type=submit]\").prop(\"disabled\", true);\n                        $group.addClass(\"has-error\");\n                    }\n                }\n            });\n        });\n        $form.find(\"#siteTitle\").on(\"keyup change\", function () {\n            if ($(this).val().length >= 5) {\n                $(this).parents(\".form-group\").first().addClass(\"has-success\");\n            } else {\n                $(this).parents(\".form-group\").first().removeClass(\"has-success\");\n            }\n        });\n        $form.find(\"#siteOrganization\").on(\"keyup change\", function () {\n            if ($(this).val().length >= 5) {\n                $(this).parents(\".form-group\").first().addClass(\"has-success\");\n            } else {\n                $(this).parents(\".form-group\").first().removeClass(\"has-success\");\n            }\n        });\n\n        let obj = this;\n        $form.find(\".navigation .btn-next\").click(function (ev) {\n            if ($(this).attr(\"type\") == \"submit\") {\n                return;\n            }\n            ev.preventDefault();\n            obj.showPanel($(obj.getNextPanel()));\n        });\n        $form.find(\".navigation .btn-prev\").click(function (ev) {\n            ev.preventDefault();\n            if (window.location.hash != \"\") {\n                window.history.back();\n            }\n        });\n        $form.submit(function () {\n\n        });\n\n        $(window).on(\"hashchange\", (ev) => {\n            ev.preventDefault();\n            let hash;\n            if (parseInt(window.location.hash.substring(1)) === 0) {\n                hash = this.firstPanel;\n            } else {\n                hash = \"#panel\" + window.location.hash.substring(1);\n            }\n            let $panel = $(hash);\n            if ($panel.length > 0) {\n                this.showPanel($panel);\n            }\n        });\n\n        $form.find(\".step-pane\").addClass(\"inactive\");\n        this.showPanel($(this.firstPanel));\n    }\n}\n\n"]}